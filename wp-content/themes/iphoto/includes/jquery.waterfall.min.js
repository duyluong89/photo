/**
 * @name jQuery waterfall Plugin
 * @version 1.0.6
 * @create 2012.1.30
 * @lastmodified 2012.2.11
 * @description Based on jQuery 1.4+
 * @author MuFeng (http://mufeng.me)
 * @url http://mufeng.me/waterfall.html
 **/
~function(c){var a=[],e=0,d=function(f,g){this.options=f;this.element=c(g);this.init()};d.prototype={init:function(){this.initArg();this.layout(this.getBricks(this.element))},getBricks:function(g){var f=this.options.itemSelector;return $bricks=!f?g.children().not(".waterfall"):g.filter(f).not(".waterfall").add(g.find(f))},getSize:function(){var l=this.getBricks(this.element)[0],j=c(l),m=this.options.columnCount,f=this.options.columnWidth,k=[],i=j.outerWidth(true),g=c(window).width()-20,o=!f?i:f,h=!m?parseInt(g/o):m;return k.concat(o,h)},initArg:function(){if(!e){this.reSize();var g,f=this.getSize(),h=f[1];for(g=0;g<h;g++){a[g]=0}e=1}},reSize:function(){if(this.options.isResizable){var f=this.getSize(),h=f[1],g=f[0];this.element.css({width:h*g})}},layout:function(m){var i=0,l=this.element,x=m.length,k=l.filter("img").add(l.find("img")).eq(0),r=k.parent(),g=this.options.isAnimated,j=this.options.Duration,f=this.options.Easing,q=this.options.endFn,v=this.getSize(),o=v[0],u,p=r.width()-parseInt(k.css("padding-left"))-parseInt(k.css("padding-right"))-parseInt(k.css("margin-left"))-parseInt(k.css("margin-right"));m.css("display","none");var h=(function(){var t=[],z=null,w=function(){var A=0;for(;A<t.length;A++){t[A].end?t.splice(A--,1):t[A]()}!t.length&&n()},n=function(){clearTimeout(z);z=null};return function(B,H,I,G){var E,C,J,F,A,D=new Image();D.src=B;if(D.complete){H(D.width,D.height);I&&I(D.width,D.height);return}C=D.width;J=D.height;E=function(){F=D.width;A=D.height;if(F!==C||A!==J||F*A>1024){H(F,A);E.end=true}};E();D.onerror=function(){G&&G();F=A=0;H(F,A);E.end=true;D=D.onload=D.onerror=null};D.onload=function(){I&&I(D.width,D.height);!E.end&&E();D=D.onload=D.onerror=null};if(!E.end){t.push(E);if(z===null){z=setTimeout(w,50)}}}})();s();function s(){if(i<x){var C=m[i],E=c(C),B=E.filter("img").add(E.find("img")).eq(0),t=E.outerHeight(true),D=Math.min.apply(Math,a),A=c.inArray(D,a);if(B.length>0){var n=B.attr("src");B.removeAttr("src");B.removeAttr("width");B.removeAttr("height");h(n,function(I,H){I=I?I:p;H=H?H:0;y=H*p/I;I=p;B.attr("src",n).css({width:I,height:H,display:"block"});var G=Math.max.apply(Math,a);l.height(G);E.addClass("waterfall");var F=E.outerHeight(true);!g?(E.css({display:"block",position:"absolute",left:A*o,top:a[A]})):(E.css({display:"block",position:"absolute",left:0,top:G}).stop().animate({left:A*o,top:a[A]},{Duration:j,Easing:f}));a[A]+=F;i++;u=setTimeout(s,50)})}else{var z=Math.max.apply(Math,a);l.height(z);E.addClass("waterfall");var w=E.outerHeight(true);!g?(E.css({display:"block",position:"absolute",left:A*o,top:a[A]})):(E.css({display:"block",position:"absolute",left:0,top:z}).stop().animate({left:A*o,top:a[A]},{Duration:j,Easing:f}));a[A]+=w;i++;u=setTimeout(s,10)}}else{if(i>=x){clearTimeout(u);u=null;var z=Math.max.apply(Math,a);l.height(z);if(typeof q=="function"){q.call(m)}}}}}};c.waterfall=function(f,g){f=c.extend({isResizable:false,isAnimated:false,Duration:500,Easing:"swing",endFn:function(){}},f);c.data(g,"waterfall",new d(f,g));return g};c.fn.waterfall=function(f){return c.waterfall(f,this)};function b(f){console.log({}.toString.call(f)+" | "+f)}}(jQuery);